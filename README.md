# 极端高温下外卖配送多主体仿真系统

## 项目概述

本项目基于LangGraph框架设计了一个多主体Agent系统，用于模拟极端高温天气下政府措施（增设纳凉点、高温补贴）对外卖小哥幸福感和健康程度的影响。

## 系统架构

### Agent类型

1. **环境规则模拟器 (Environment)**
   - 生成24小时温度曲线（极端高温场景）
   - 管理阴凉覆盖率、休息区覆盖率
   - 生成订单距离（遵循Zipf分布）和价格

2. **客户群体 (Customers)**
   - 状态：点外卖评分历史
   - 行为：在用餐时间根据温度和服务评分决定是否下单
   - 交互：对配送服务评分和给小费

3. **外卖骑手 (Riders)**
   - 状态：健康状况、资金、在职状态、幸福感
   - 行为：根据健康状况和环境条件决定接单、休息或投诉
   - 影响：高温配送会损害健康，影响幸福感

4. **外卖平台 (Platform)**
   - 状态：资金、税收时间
   - 行为：计算收益、管理骑手、缴税
   - 决策：解雇表现差的骑手

5. **政府 (Government)**
   - 状态：预算、补贴记录、基础设施建设
   - 行为：观察骑手投诉和健康状况
   - 政策：发放高温补贴、增设纳凉点

### 工作流程

每个Agent都遵循 **Observation → Thought → Action → Pause** 的工作流：

- **Observation**: 观察环境状态和其他Agent行为
- **Thought**: 基于观察进行决策思考
- **Action**: 执行具体行动
- **Pause**: 更新自身状态

## 文件结构

```
heatweather/
├── environment.py          # 环境规则模拟器
├── agents.py              # 所有Agent定义
├── utils.py               # 工具函数和日志记录
├── simulation.py          # LangGraph版本仿真（开发中）
├── complete_simulation.py # 完整版仿真系统
├── test_simple.py         # 简化测试版本
├── main.py               # 主程序入口
├── requirements.txt      # 依赖包列表
└── README.md            # 项目说明文档
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行测试

运行简化版本测试（2天，少量Agent）：

```bash
python test_simple.py
```

### 3. 运行完整仿真

运行完整版仿真系统：

```bash
python complete_simulation.py
```

或使用主程序：

```bash
python main.py
```

## 仿真参数

- **客户数量**: 默认10个，模拟点外卖群体
- **骑手数量**: 默认3个，模拟外卖配送员
- **仿真天数**: 默认30天，可自定义
- **时间粒度**: 每小时为一个时间步
- **温度范围**: 32-48°C（极端高温场景）

## 关键指标

### 健康影响模型

骑手配送时的健康损失计算：
```
健康损失 = (温度 - 35) × K × 距离 × (1 - 阴凉覆盖率)
```

### 幸福感模型

综合考虑健康、收入和环境因素：
```
幸福感 = 健康因素×0.4 + 收入因素×0.3 + 温度因素×0.3
```

### 政府措施触发条件

- **高温补贴**: 温度>38°C时发放，极端高温(>42°C)时加倍
- **增设纳凉点**: 温度>40°C且投诉>3次且覆盖率<0.8时建设

## 输出结果

### 1. 实时日志
每个Agent的思考和行为都会实时输出，包括：
- 观察到的环境状态
- 决策思考过程
- 执行的具体行动

### 2. 数据记录
- **JSON日志**: 详细的Agent行为记录
- **每日统计**: 健康、幸福感、订单完成率等指标
- **最终分析**: 政策效果评估和建议

### 3. 可视化图表
- 温度与健康趋势图
- 幸福感变化曲线
- 订单完成情况
- 政府措施效果
- 骑手个体表现分析

## 政策效果评估

系统会自动评估政策效果：

- **健康水平**: 优秀(≥8) / 良好(≥6) / 一般(≥4) / 较差(<4)
- **幸福感**: 优秀(≥7) / 良好(≥5) / 一般(≥3) / 较差(<3)
- **服务质量**: 基于订单完成率评估
- **政策建议**: 基于仿真结果自动生成改进建议

## 使用场景

1. **政策制定**: 评估不同政府措施的效果
2. **学术研究**: 多主体系统建模和仿真
3. **社会治理**: 极端天气下的劳动者保护政策研究
4. **教学演示**: Agent系统和复杂系统仿真教学

## 技术特点

- **多主体建模**: 真实模拟不同角色的互动
- **动态环境**: 温度、覆盖率等环境参数动态变化
- **智能决策**: 每个Agent都有自主的决策能力
- **完整记录**: 所有Agent的思考和行为都被详细记录
- **可扩展性**: 可以轻松添加新的Agent类型或行为规则

## 注意事项

1. 仿真时间较长时（如30天），输出信息会很多，建议适当调整输出频率
2. 图表生成需要matplotlib支持，确保环境配置正确
3. 可以通过修改Agent的决策参数来测试不同的政策效果
4. 建议先运行小规模测试，确认系统正常后再进行大规模仿真

## 后续开发

- [ ] 完善LangGraph版本的实现
- [ ] 添加更多政府政策选项
- [ ] 增强可视化效果
- [ ] 支持参数敏感性分析
- [ ] 添加Web界面展示

## 联系方式

如有疑问或建议，请随时沟通交流。
